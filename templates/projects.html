{% extends "base" %}
{% block content %}
<nav class="nav">
    <a href="{{ url_for('dashboard') }}" class="nav-brand">
        <svg viewBox="0 0 512 512" width="32" height="32">
            <defs>
                <linearGradient id="grad3" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#8B5CF6" />
                    <stop offset="100%" style="stop-color:#6366F1" />
                </linearGradient>
            </defs>
            <rect width="512" height="512" rx="96" fill="white"/>
            <rect x="120" y="80" width="220" height="300" rx="24" fill="url(#grad3)"/>
            <circle cx="310" cy="350" r="70" fill="#10B981"/>
            <path d="M275 350 L300 375 L355 315" fill="none" stroke="white" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Jottask
    </a>

    <div class="nav-links">
        <a href="{{ url_for('dashboard') }}" class="nav-link">Tasks</a>
        <a href="{{ url_for('projects') }}" class="nav-link active">Projects</a>
        <a href="{{ url_for('settings') }}" class="nav-link">Settings</a>
    </div>

    <div class="nav-user">
        <span style="color: var(--gray-500);">{{ session.user_name }}</span>
        <div class="avatar">{{ session.user_name[0].upper() }}</div>
        <a href="{{ url_for('logout') }}" class="btn btn-secondary btn-sm">Logout</a>
    </div>
</nav>

<main class="main">
    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ stats.active }}</div>
            <div class="stat-label">Active Projects</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_items }}</div>
            <div class="stat-label">Total Items</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.completed_items }}</div>
            <div class="stat-label">Items Completed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.completed_projects }}</div>
            <div class="stat-label">Projects Completed</div>
        </div>
    </div>

    <!-- Projects Card -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">Projects</h2>
            <a href="{{ url_for('project_create') }}" class="btn btn-primary">
                + New Project
            </a>
        </div>

        <div class="tabs" style="padding: 0 20px;">
            <div class="tab {% if filter == 'active' %}active{% endif %}" onclick="location.href='?filter=active'">Active</div>
            <div class="tab {% if filter == 'completed' %}active{% endif %}" onclick="location.href='?filter=completed'">Completed</div>
            <div class="tab {% if filter == 'archived' %}active{% endif %}" onclick="location.href='?filter=archived'">Archived</div>
            <div class="tab {% if filter == 'all' %}active{% endif %}" onclick="location.href='?filter=all'">All</div>
        </div>

        <div class="project-list">
            {% if projects %}
                {% for project in projects %}
                <a href="{{ url_for('project_detail', project_id=project.id) }}" class="project-item" style="text-decoration: none; color: inherit;">
                    <div class="project-color" style="background: {{ project.color or '#6366F1' }};"></div>

                    <div class="project-content">
                        <div class="project-title">{{ project.name }}</div>
                        <div class="project-meta">
                            <span>{{ project.item_count or 0 }} items</span>
                            {% if project.description %}
                            <span>{{ project.description[:50] }}{% if project.description|length > 50 %}...{% endif %}</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="project-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ project.progress or 0 }}%;"></div>
                        </div>
                        <span class="progress-text">{{ project.progress or 0 }}%</span>
                    </div>

                    <div class="project-status">
                        <span class="status-badge" style="background: {% if project.status == 'active' %}var(--primary){% elif project.status == 'completed' %}var(--success){% else %}var(--gray-300){% endif %}; color: white;">
                            {{ project.status|capitalize }}
                        </span>
                    </div>
                </a>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìÅ</div>
                    <h3>No projects yet</h3>
                    <p>Create your first project or email "Project: Name - items" to jottask@flowquote.ai</p>
                </div>
            {% endif %}
        </div>
    </div>
</main>

<style>
.project-list {
    display: flex;
    flex-direction: column;
}

.project-item {
    display: flex;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--gray-100);
    gap: 16px;
    transition: background 0.2s;
}

.project-item:hover {
    background: var(--gray-50);
}

.project-item:last-child {
    border-bottom: none;
}

.project-color {
    width: 8px;
    height: 48px;
    border-radius: 4px;
    flex-shrink: 0;
}

.project-content {
    flex: 1;
    min-width: 0;
}

.project-title {
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 4px;
}

.project-meta {
    display: flex;
    gap: 16px;
    font-size: 13px;
    color: var(--gray-500);
}

.project-progress {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 150px;
}

.progress-bar {
    flex: 1;
    height: 8px;
    background: var(--gray-200);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: var(--success);
    transition: width 0.3s;
}

.progress-text {
    font-size: 13px;
    color: var(--gray-500);
    min-width: 35px;
}

.project-status {
    flex-shrink: 0;
}

@media (max-width: 768px) {
    .project-progress {
        display: none;
    }
}
</style>
{% endblock %}